<!DOCTYPE html>
<html>
<link href='https://fonts.googleapis.com/css?family=Josefin+Slab:700|Lato|Ubuntu' rel='stylesheet' type='text/css'>
<style>
*, *::before, *::after {
  box-sizing: border-box;
}

body {
	font-family: 'Ubuntu', serif;
	font-size: 16px;
}
h1 {
	font-family: 'Josefin Slab', serif;
	font-size: 60px;
	line-height: 35px;
	font-weight: bold;
	text-align: center;
    border-bottom: 3px solid;
}
.box {
	font-family: 'Lato', sans-serif;
	font-size: 18px;
	line-height: 20px;
	font-weight: bold;
	text-align: center;
}
.tagIcon {
	font-family: 'Lato', sans-serif;
	font-weight: bold;
	height: 30px;
	margin: 15px;
	line-height: 32px;
	position: relative;
	margin-bottom: 10px;
	padding: 0 15px 0 15px;
	background: #222;
	color: white;
	text-decoration: none;
	border-radius:0 4px 4px 0;
}
.tagIcon:before {
   content: "";
   position: absolute;
   top: 0;
   left: -15px;
   border-color: transparent #222 transparent transparent;
   border-style: solid;
   border-width: 15px 15px 15px 0;
}
.tagIcon::after {
   content: '';
   position: absolute;
   top: 12px;
   left: 0;
   float: left;
   width: 5px;
   height: 5px;
   border-radius: 100%;
   background: #fff;
}
.tagIcon:hover {
   background:#333;
} 
.tagIcon:hover:before {
   border-color: transparent #333 transparent transparent;
}
.definition {
   position: relative;
}
article {
	margin-left: 30px;
	font-family: 'Lato', sans-serif;
	font-size: 17px;
	font-weight: bold;
	-webkit-column-width: 150px;
    -moz-column-width: 150px;
    column-width: 150px;
}
.container, .backdrop, textarea {
  width: 100%;
  height: 180px;
}

.highlights, textarea {
  padding: 10px;
  font-family: 'Lato', sans-serif;
  font-size: 15px;
  letter-spacing: 1px;
}

.container {
  display: block;
  margin: 0 auto;
  -webkit-transform: translateZ(0);
          transform: translateZ(0);
  -webkit-text-size-adjust: none;
}

.backdrop {
  position: absolute;
  z-index: 1;
  border: 2px solid black;
  background-color: #fff;
  overflow: auto;
  pointer-events: none;
  -webkit-transition: -webkit-transform 1s;
  transition: -webkit-transform 1s;
  transition: transform 1s;
  transition: transform 1s, -webkit-transform 1s;
}

.highlights {
	white-space: pre-wrap;
	word-wrap: break-word;
	color: transparent;
}

textarea {
  display: block;
  position: absolute;
  z-index: 2;
  margin: 0;
  border: 2px solid black;
  border-radius: 0;
  color: #444;
  background-color: transparent;
  overflow: auto;
  resize: none;
  -webkit-transition: -webkit-transform 1s;
  transition: -webkit-transform 1s;
  transition: transform 1s;
  transition: transform 1s, -webkit-transform 1s;
}

mark {
  border-radius: 1px;
  color: transparent;
  background-color: #fff2a8;
}

button {
	width: 300px;
	margin: 30px auto 0;
	padding: 10px;
	-webkit-appearance: none;
	 -moz-appearance: none;
		  appearance: none;
	cursor: pointer;
	border: 2px solid;
	line-height: 26px;
	background-color: black;
	color: white;
	font-family: 'Lato', sans-serif;
	font-size: 18px;
	font-weight: bold;
}
textarea:focus, button:focus {
  outline: none;
}
</style>
<body>
	<h1>frazefinder</h1>
	<div class="container">
		<div class="backdrop" id="backdrop">
			<div class="highlights" id="highlights"></div>
		</div>
		<textarea rows="10" id="input" placeholder="enter some text"></textarea>
	</div>
	<div class="box">
		<button id="search">analyze</button>
		<button id="example">show demo</button>
	</div>
	<div class="tagIcon">expressions / collocations list</div>
	<div class="definition" id="expressionsheader">
		<article id="expressions"></article>
	</div>
</body>
<script>
function CHR(t){return BASE64[t]}function ORD(t){return BASE64_CACHE[t]}function BitString(t){this.init(t)}function RankDirectory(t,i,e,n,r){this.init(t,i,e,n,r)}function FrozenTrieNode(t,i,e,n,r,s){this.trie=t,this.index=i,this.letter=e,this["final"]=n,this.firstChild=r,this.childCount=s}function FrozenTrie(t,i,e){this.init(t,i,e)}var BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",W=6,BASE64_CACHE={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"-":62,_:63},L1=1024,L2=32;BitString.MaskTop=[63,31,15,7,3,1,0],BitString.BitsInByte=[0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,5,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,5,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,5,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,3,4,4,5,4,5,5,6,4,5,5,6,5,6,6,7,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,5,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,3,4,4,5,4,5,5,6,4,5,5,6,5,6,6,7,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,6,3,4,4,5,4,5,5,6,4,5,5,6,5,6,6,7,3,4,4,5,4,5,5,6,4,5,5,6,5,6,6,7,4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8],BitString.prototype={init:function(t){this.bytes=t,this.length=this.bytes.length*W},getData:function(){return this.bytes},get:function(t,i){if(W>=t%W+i)return(ORD(this.bytes[t/W|0])&BitString.MaskTop[t%W])>>W-t%W-i;var e=ORD(this.bytes[t/W|0])&BitString.MaskTop[t%W],n=W-t%W;for(t+=n,i-=n;i>=W;)e=e<<W|ORD(this.bytes[t/W|0]),t+=W,i-=W;return i>0&&(e=e<<i|ORD(this.bytes[t/W|0])>>W-i),e},count:function(t,i){for(var e=0;i>=8;)e+=BitString.BitsInByte[this.get(t,8)],t+=8,i-=8;return e+BitString.BitsInByte[this.get(t,i)]},rank:function(t){for(var i=0,e=0;t>=e;e++)this.get(e,1)&&i++;return i}},RankDirectory.prototype={init:function(t,i,e,n,r){this.directory=new BitString(t),this.data=new BitString(i),this.l1Size=n,this.l2Size=r,this.l1Bits=Math.ceil(Math.log(e)/Math.log(2)),this.l2Bits=Math.ceil(Math.log(n)/Math.log(2)),this.sectionBits=(n/r-1)*this.l2Bits+this.l1Bits,this.numBits=e},getData:function(){return this.directory.getData()},rank:function(t,i){if(0===t)return i-this.rank(1,i)+1;var e=0,n=i,r=0;return n>=this.l1Size&&(r=(n/this.l1Size|0)*this.sectionBits,e=this.directory.get(r-this.l1Bits,this.l1Bits),n%=this.l1Size),n>=this.l2Size&&(r+=(n/this.l2Size|0)*this.l2Bits,e+=this.directory.get(r-this.l2Bits,this.l2Bits)),e+=this.data.count(i-i%this.l2Size,i%this.l2Size+1)},select:function(t,i){for(var e=this.numBits,n=-1,r=-1;e-n>1;){var s=(e+n)/2|0,h=this.rank(t,s);h===i?(r=s,e=s):i>h?n=s:e=s}return r}},FrozenTrieNode.prototype={getChildCount:function(){return this.childCount},getChild:function(t){return this.trie.getNodeByIndex(this.firstChild+t)}},FrozenTrie.prototype={init:function(t,i,e){this.data=new BitString(t),this.directory=new RankDirectory(i,t,2*e+1,L1,L2),this.letterStart=2*e+1},getNodeByIndex:function(t){var i=1===this.data.get(this.letterStart+6*t,1),e=String.fromCharCode(this.data.get(this.letterStart+6*t+1,5)+"a".charCodeAt(0));"{"==e&&(e=" "),"|"==e&&(e=","),"}"==e&&(e="'"),"~"==e&&(e="-");var n=this.directory.select(0,t+1)-t,r=this.directory.select(0,t+2)-t-1;return new FrozenTrieNode(this,t,e,i,n,r-n)},getRoot:function(){return this.getNodeByIndex(0)},lookup:function(t){for(var i=this.getRoot(),e=0;e<t.length;e++){for(var n,r=0;r<i.getChildCount()&&(n=i.getChild(r),n.letter!==t[e]);r++);if(r===i.getChildCount())return!1;i=n}return i["final"]}};
</script> 
<script>
var expressions = ''
var ftrie = ''

	function syncViews() {
		//var text = document.getElementById('input').value
		//var highlightedText = text.replace(/\n$/g, '\n\n').replace(/[A-Z].*?\b/g, '<mark>$&</mark>')
		//document.getElementById('highlights').innerHTML = highlightedText
	}
	document.getElementById("input").addEventListener("input", function(e){
		syncViews()
	})
	document.getElementById("input").addEventListener("scroll", function(e){
		document.getElementById('backdrop').scrollTop = document.getElementById('input').scrollTop
		document.getElementById('backdrop').scrollLeft = document.getElementById('input').scrollLeft
	})
	window.onload = function() {
			var req = new XMLHttpRequest()
			req.open('GET', 'expressions.json', true)
			req.onload = function () {
				expressions = JSON.parse(req.responseText)
				ftrie = new FrozenTrie(expressions[2], expressions[1], expressions[0])
			}
			req.send()
			syncViews()
	}
	document.getElementById("example").addEventListener("click", function(event) {
		document.getElementById('input').value = "Are the numbers of boys and girls in our families really down to the toss of a coin? In fact, it's not quite so simple. You as an individual may actually load the dice towards a son or a daughter right at conception. Especially the condition of mothers could be playing a part according to some studies. Ruth Mace was in Ethiopia when that country was hit by a severe food shortage. As part of a study on nutrition she looked at the birth statistics of women caught up in the crisis: Mothers that had a higher body-mass index were more likely to have boys than girls. Why this happens is still open to debate. Valerie Grant says dominance in personality may also tip the balance towards male offspring. 'I've come to notice that dominant women tend to have more boys. The explanation may be that dominant women have higher levels of the male hormone, testosterone.' She also proposes an explanation for the higher ratio of boys born in times of war. It also features the testosterone that is at the heart of her dominance theory, but it's all about stress in this case. 'Testosterone in women rises under stress. So, women who might be just below the level for conceiving a son in normal times may be more likely to conceive sons in times of hardship.'"
		document.getElementById("search").click()
	})
	document.getElementById("search").addEventListener("click", function(event) {
		function Grams(sentence) {
			var sentenceGrams = []
			sentenceWords = sentence.match(/\w+/g)
			for (i=0; i < sentenceWords.length -1; i++) {
				sentenceGrams.push(sentenceWords[i] + ' ' + sentenceWords[i+1])
				if (i < sentenceWords.length -2) sentenceGrams.push(sentenceWords[i] + ' ' + sentenceWords[i+1] + ' ' + sentenceWords[i+2])
				if (i < sentenceWords.length -3) sentenceGrams.push(sentenceWords[i] + ' ' + sentenceWords[i+1] + ' ' + sentenceWords[i+2] + ' ' + sentenceWords[i+3])
				if (i < sentenceWords.length -4) sentenceGrams.push(sentenceWords[i] + ' ' + sentenceWords[i+1] + ' ' + sentenceWords[i+2] + ' ' + sentenceWords[i+3] + ' ' + sentenceWords[i+4])
				if (i < sentenceWords.length -5) sentenceGrams.push(sentenceWords[i] + ' ' + sentenceWords[i+1] + ' ' + sentenceWords[i+2] + ' ' + sentenceWords[i+3] + ' ' + sentenceWords[i+4] + ' ' + sentenceWords[i+5])
			}
			return sentenceGrams
		}
		
		var sentence = document.getElementById("input").value.toLowerCase()
		sentenceGram = Grams(sentence)
		document.getElementById('highlights').innerHTML = document.getElementById('input').value
		for (i=0; i<sentenceGram.length; i++) {
			try {
				if ( ftrie.lookup(sentenceGram[i])) {
					document.getElementById('expressions').innerHTML += '<li>' + sentenceGram[i] + '</li>'
					var text = document.getElementById('highlights').innerHTML
					var regexp = new RegExp(sentenceGram[i], 'ig')
					var highlightedText = text.replace(regexp, '<mark>$&</mark>')
					document.getElementById('highlights').innerHTML = highlightedText
				}
			}
			catch ( e ) {
				document.getElementById('expressions').innerHTML = 'Some weird error happened. Sorry! Try refreshing the page, that could work.'
			}
		}
		
	})
</script>
</html>